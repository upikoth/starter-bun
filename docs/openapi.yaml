openapi: 3.1.0
info:
  title: Starter API
  version: 1.0.0

servers:
  - url: http://localhost:8000/
    description: Dev server
  - url: https://starter.upikoth.dev/
    description: Production server

externalDocs:
  description: Документация по проекту starter
  url: https://upikoth.dev/projects/starter/intro.html

tags:
  - name: health
    description: Проверка работоспособности приложения
  - name: sessions
    description: CRUD методы для сессии

paths:
  /api/v1/health:
    get:
      tags:
        - health
      description: Проверка работоспособности приложения
      responses:
        200:
          description: Приложение работает
          $ref: '#/components/responses/defaultSuccess'

  /api/v1/session:
    get:
      tags:
        - sessions
      description: Получение информации о текущей сессии пользователя
      security:
        - cookieAuth: []
      responses:
        200:
          description: Информация о текущей сессии пользователя
          $ref: '#/components/responses/sessionsGetCurrentSessionSuccess'
        401:
          description: Пользователь не авторизован
          $ref: '#/components/responses/defaultNotAuthorized'

components:
  schemas:
    user:
      type: object
      required:
        - id
        - email
        - status
        - role
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        status:
          type: string
          enum:
            - active
            - blocked
        role :
          type: string
          enum:
            - user
            - admin
            - super-admin

    session:
      type: object
      required:
        - id
      properties:
        id:
          type: integer

    defaultSuccessResponse:
      type: object
      required:
        - success
        - data
      properties: 
        success:
          type: boolean
          enum:
            - true
        data:
          type: object

    defaultNotAuthorizedResponse:
      type: object
      required:
        - success
        - data
        - error
      properties: 
        success:
          type: boolean
          enum:
            - false
        data:
          type: object
        error:
          type: object
          required:
            - code
            - description
          properties:
            code:
              type: integer
              enum:
                - 9
            description:
              type: string
              enum:
                - 'Пользователь не авторизован'

    sessionsGetCurrentSessionSuccessResponse:
      type: object
      required:
        - success
        - data
      properties: 
        success:
          type: boolean
          enum:
            - true
        data:
          type: object
          required:
            - user
            - session
          properties:
            user:
              $ref: '#/components/schemas/user'
            session:
              $ref: '#/components/schemas/session'

  responses:
    defaultSuccess:
      description: Стандартный ответ при успешно выполенном запросе
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/defaultSuccessResponse'
          examples:
            defaultSuccess:
              summary: Успешный ответ без доп. информации
              externalValue: /api/docs/examples/default/200.json

    defaultNotAuthorized:
      description: Пользователь не авторизован
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/defaultNotAuthorizedResponse'
          examples:
            defaultNotAuthorized:
              summary: Ошибка авторизации
              externalValue: /api/docs/examples/default/401.json

    sessionsGetCurrentSessionSuccess:
      description: Успешное получение информации о сессии пользователя
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/sessionsGetCurrentSessionSuccessResponse'
          examples:
            activeUser:
              summary: Активный пользователь
              externalValue: /api/docs/examples/sessions/get-current-session/response-success.json

  securitySchemes:
    cookieAuth:
      name: Authorization
      description: Авторизация с помощью токена. Значение передается в cookie Authorization
      type: apiKey
      in: cookie

security:
  - cookieAuth: []
